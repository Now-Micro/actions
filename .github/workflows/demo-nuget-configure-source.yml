name: demo-nuget-configure-source

on:
  workflow_dispatch:
  push:
    paths:
      - 'nuget/configure-source/**'
      - 'dotnet/build/**'
      - '.github/workflows/demo-nuget-configure-source.yml'

jobs:
  direct-configure:
    name: Direct configure-source usage
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Setup .NET
        uses: actions/setup-dotnet@v4
        with:
          dotnet-version: '8.0.x'

      - name: Configure multiple NuGet sources (direct)
        uses: ./nuget/configure-source
        with:
          names: 'DemoSource1, DemoSource2'
          usernames: 'demo-user-1, demo-user-2'
          passwords: 'demo-pass-1, demo-pass-2'
          urls: 'https://example.invalid/feed1/index.json, https://example.invalid/feed2/index.json'

      - name: List configured NuGet sources
        run: dotnet nuget list source

  build-uses-configure:
    name: dotnet/build uses configure-source
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Run build (invokes configure-source internally)
        uses: ./dotnet/build
        with:
          solution-file: demo/dotnet/demo.sln
          github-packages-token: dummy-github-token
          azure-devops-password: dummy-ado-token
          node-project-path: ''
          upload-artifact-paths: ''

  skips-configure:
    name: Skips configure-source
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Setup .NET
        uses: actions/setup-dotnet@v4
        with:
          dotnet-version: '8.0.x'

      - name: Configure multiple NuGet sources (direct)
        uses: ./nuget/configure-source
        with:
          usernames: 'demo-user-1, demo-user-2'
          passwords: 'demo-pass-1, demo-pass-2'
          urls: 'https://example.invalid/feed1/index.json, https://example.invalid/feed2/index.json'

      - name: List configured NuGet sources
        run: dotnet nuget list source
